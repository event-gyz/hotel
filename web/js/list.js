define("HOC/hoistLifeCycle",["require","exports","module","UIWarning404"],function(t,e,a){function i(t,e,a,i,s){_.include(s,i)||a[i]&&(t.prototype[i]=function(){var t=this.config||this.modalConfig||{};if(a[i].apply(this,arguments),e.prototype.hasOwnProperty(i))try{e.prototype[i].apply(this,arguments)}catch(s){if(t.showWarning404UponLifeCycleError&&(this._warning404||(this._warning404=new n({wrapper:this.$el,datamodel:{tel:t.warning404Tel||"4008286936",loadFail:t.warning404LoadFail||"加载失败，请稍后再试试吧",telText:t.warning404TelText||"或者拨打客服电话 ",tryAgain:t.warning404TryAgain||"重试",contact:t.warning404Contact||"联系客服",showContact:t.warning404ShowContact},retryAction:t.warning404RetryAction||location.reload.bind(location)})),this._warning404.show()),"function"!=typeof this.onLifeCycleError)throw s;if(!this.onLifeCycleError(s,i))throw s}})}var n=t("UIWarning404");return function(t,e){var a,n;if(_.isArray(e)||(e=[]),!Backbone.View.prototype.isPrototypeOf(t.prototype))throw new Error("View 参数必须是 Backbone.View");if(n=t.__super__,!n){try{throw new Error}catch(s){}return t}return a=t.extend(),i(a,t,n,"onCreate",e),i(a,t,n,"onShow",e),i(a,t,n,"onHide",e),i(a,t,n,"onAppear",e),a}}),define("lib/parseActivityDepositListQConfig",["require","exports","module"],function(t,e,a){function i(t){return String(t||"").replace(/[^\d|,，]/g,"").split(/,|，/).filter(function(t){return t}).map(function(t){return t=t.split("|"),{activityId:t[0],amount:t[1]}})}return i}),define(["B2CPageList","MTModel","MTStore","B2Ccommon","UIScrollLayer","cUtilDate","UICalendarCommon","toolsUtil","HOC/hoistLifeCycle","lib/parseActivityDepositListQConfig","tools/fmt"],function(t,e,a,i,n,s,r,o,c,l,d){var h=e.SearchMeetingList.getInstance(),m=a.ActivityListBackTrace.getInstance(),f=t.extend({pageid:"10320674852",hpageid:"10320674853",pinyin:"",activityid:null,preBookTips:"",bookStartDate:null,bookEndDate:null,StartDate:null,EndDate:null,calStartDate:null,calEndDate:null,Deposit:{need:!1,amount:0},_from:Lizard.P("fr")||Lizard.P("from"),_fr:Lizard.P("fr")||Lizard.P("from"),index:{localKey:"HasOpenedB2cIndexWebview",pagename:"b2croom/index"},staticTmp:_.template(Lizard.T("mianTmpl")),listTmpl:_.template(Lizard.T("listTmpl")),calender_tmpl:_.template(Lizard.T("calender_tmpl")),noresultTmpl:_.template(Lizard.T("noresultTmpl")),isApp:Lizard.app.vendor.is("CTRIP"),isIOS:$.os.ios,onCreate:function(){this.firstload=!0,Lizard.showLoading()},onShow:function(){var t=this,e="选择酒店";if(this.isApp&&this.isIOS&&CtripUtil&&CtripUtil.appSetWebviewBounce(!0),this.setHeader_extr(e,!0),t.setWeiXinTitle(""),this.isCtnrView=!1,this.setBackTrace(),this.firstload){this.firstload=!1,this.pinyin=(window.location.pathname.match(/b2croom\/(\S*)\//)||[,])[1];var t=this;this.ajaxActivityInfo.call(t,!!Lizard.P("UGC"),!0,!0,null,t.reqComplete,t.reqFail),w.init.call(this),this.onShowReset()}},onAppear:function(){},onHide:function(){w.off()},onShowReset:function(){var t=Lizard.instance.curView.referrer;if(t){if(t.indexOf("frcalander")>-1)return;(t.indexOf("picture")>-1||t.indexOf("list")>-1)&&window.scrollTo(0,0)}w.reset()},reqComplete:function(t){var e=this,a=t;Lizard.hideLoading(),this.pinyin=a.activityPinYin,this.activityid=a.activityId,this.distanceName=a.distanceName||"会场",a.activityRule&&(this.preBookTips=a.activityRule.preBookTips),this.getDepositInfo(this.activityid),this.renderStaticInfo(a),p.init.call(e,a),this.getDataPage(),this.setPageId("10320674852","10320674853")},reqFail:function(t){var e=t?"请求失败":"没有数据";this.renderStaticInfo(e)},renderStaticInfo:function(t){this.pinyin=t.activityPinYin,this.activityid=t.activityId,this.$el.find(".list-main").html(this.staticTmp({data:t,deposit:this.Deposit}))},setHeader_extr:function(t){var e=this,a=location.pathname.toLocaleLowerCase(),i=(a.match(/b2croom\/(\S*)\//)||[,])[1]||Lizard.P("activityname")||Lizard.P("activitypinyin");e.prjFolder+i+"/index";e.setRightMenus(),this.headerview.set({title:t,back:!0,home:!1,right:this.rightMenus,events:{returnHandler:function(){var t=Lizard.P("ismkt")||(m.get()||{}).b2chotels,a={defaultH5:"b2croom/"+i+"/index",blacks:["b2croom/detail"]};Lizard.P("backtohome")&&(a.appPageArgs="MTG_ACT_"+i.toUpperCase()),t&&(a.defaultH5=t),a.fn=function(){t&&m.remove()},e.vaBack(a)}}}),this.headerview.show()},setRightMenus:function(){var t=this;this.rightMenus=[];var e={tagname:"more_share",itemFn:function(){return'<span id="js_hd_share" class="cm-header-icon fr hd-space-r"><i class="share-icon"></i> </span>'},callback:function(){}};this.rightmenus=[e],this.isApp&&(e.callback=function(e){var a=[{shareType:"Default",title:t.shareTitle,imageUrl:t.shareIcon,text:t.shareDesc,linkUrl:window.location.href}];CtripShare.app_call_custom_share(a)},this.rightMenus=[e])},setBackTrace:function(){var t=this,e=(m.get()||{}).b2chotels,a="b2croom/index",i=Lizard.P("ismkt");i?m.set({b2chotels:i}):a.indexOf(t.referrer)>-1&&e&&m.remove()},getDataPage:function(){var t=this,e=t.StartDate,a=t.EndDate;t.setCalBars(e,a),t.renderEmpty();var i={SearchParameters:{DateRange:{StartDate:e,EndDate:a}},DistributionChannel:{SourceType:"PinFangH5",AppId:"100002496",ServerFrom:"m.ctrip.com/webapp/meeting",ActivityID:t.activityid},MeetPkgSearchListRequestHead:{AppID:"100002496",LanguageType:"CH",Version:"4",RequestId:"1",RequestType:""},Version:1};h.abort(),h.setParam(i),t.excuting=!0,h.excute(function(e){var a=e.PlaceSearchResult||{};dt=a.AggregatePackItemas||[],dt.length>0?t.renderList(dt):t.noListResult()},function(e){t.noListResult(e)},!0,this)},getDepositInfo:function(t){var e=l($("#qcfg-activity_deposit_list").html()),a=_.findWhere(e,{activityId:t+""});a&&(this.Deposit.need=!0,this.Deposit.amount=a.amount)},renderList:function(t){Lizard.hideLoading();var e=this.processItems(t);this.$el.find(".js-list").html(this.listTmpl({data:e})),this.handleTips(!0)},renderEmpty:function(){this.$el.find(".js-list").html('<div class="mt-loading-more g-noDate"><span class="cui-pro-load cui-m-load"><span class="cui-pro-radius"></span><span class="cui-i cui-pro-logo"></span></span><span class="g-load-txtpl">加载中...</span></div>'),this.handleTips(!1)},processItems:function(t){var e=this,a=[{min:0,max:1.5,"class":"h_icons_diamond1",name:"经济型"},{min:1.5,max:2,"class":"h_icons_diamond15",name:"经济型"},{min:2,max:2.5,"class":"h_icons_diamond2",name:"舒适型"},{min:2.5,max:3,"class":"h_icons_diamond14",name:"舒适型"},{min:3,max:3.5,"class":"h_icons_diamond3",name:"高档型"},{min:3.5,max:4,"class":"h_icons_diamond13",name:"高档型"},{min:4,max:4.5,"class":"h_icons_diamond4",name:"豪华型"},{min:4.5,max:5,"class":"h_icons_diamond12",name:"豪华型"},{min:5,max:5.5,"class":"h_icons_diamond5",name:"豪华型"},{min:5.5,max:6,"class":"h_icons_diamond11",name:"豪华型"},{min:6,max:6.5,"class":"h_icons_diamond6",name:"豪华型"},{min:6.5,max:7,"class":"h_icons_diamond10",name:"豪华型"},{min:7,max:8,"class":"h_icons_diamond7",name:"豪华型"}];if(!t.length)return t;var i=[];return _.each(t,function(t,n){var s={HotelId:t.HotelId,HotelName:t.HotelInfo&&t.HotelInfo.HotelName,img:"",star_cls:"",commscore_txt:t.HotelInfo&&t.HotelInfo.HRatingOverall,address:null,distance:"",floor_price:null,sold_out:t.HotelInfo&&0==t.HotelInfo.SurplusQuantity||null,surplusquantity:t.HotelInfo&&t.HotelInfo.SurplusQuantity&&t.HotelInfo.SurplusQuantity,lablelist:[],channeltype:null};if(t.HotelInfo){s.floor_price=t.HotelInfo.MinPrice;var r=t.HotelInfo.HotelLogoURL||t.MeetingPlacePictureUrl;if(r&&(s.img=e.dealWithImgUrl(r,"_R_250_250_Q70",!0)),t.HotelInfo.ActivityInfo){var o=t.HotelInfo.ActivityInfo;s.lablelist=o.ActivityLableList||[],s.channeltype=o.ChannelType;var c=o.CoordinateList&&o.CoordinateList[0]||{};if(!_.isEmpty(c)){var l=1e3*c.Distance;if(l){var d=100>l&&"＜100m"||1e3>l&&Math.round(l)+"m"||l>=1e3&&parseFloat((Math.round(l)/1e3).toFixed(1))+"km"||l+"m";s.distance="距"+c.Description+" "+d}}}}if(s.address=t.LocationName+(t.ZoneName1?(t.LocationName?" · ":"")+t.ZoneName1+(t.ZoneName2?" · "+t.ZoneName2:""):""),t.IsStarLicence)parseInt(t.Star)>=0&&(s.star_cls="g-star ico_star0"+t.Star);else for(var h=0;h<a.length;h++)t.CustomEval>=a[h].min&&t.CustomEval<a[h].max&&(s.star_cls=a[h]["class"]+" h_icons");i[n]=s}),i},handleTips:function(t){var e=this.$el.find(".js-tips");t?e.show():e.hide()},noListResult:function(t){Lizard.hideLoading();var e=t?'<div class="g-noDate js-reload">加载失败请重试</div>':this.noresultTmpl({});this.$el.find(".js-list").html(e),this.handleTips(!1)},listShowLoading:function(){this.els.listLoad.show(),this.els.listNoMore.hide()},showTipLayer:function(t){var e=this;if(e.preBookTips){var a=e.preBookTips,i=a.replace(/[\r|\n]/g,"<br />");e.tipLayer=new n({datamodel:{title:"温馨提示",btns:'<button class="bor-top ok-btn">我知道了</button>'},html:"<p>"+i+"</p>",wrapper:$(".tip-layer"),animateInClass:"animate-in",animateOutClass:"animate-out",needReposition:!0,width:.8*$(window).width(),events:{"click .ok-btn":"selfClick"},selfClick:function(){this.hide()}}),e.tipLayer.show(),e.appendUIScrollLayer(e.tipLayer)}},goToDetail:function(t){var e=$(t.currentTarget).attr("data-hotelid"),a=$(t.currentTarget).attr("data-channel"),i=d("b2croom/detail?hotelid={0}&activityname={1}&activityid={2}&startDate={3}&endDate={4}&bust={5}",e,this.pinyin,this.activityid,this.StartDate,this.EndDate,Number(new Date));if("2"==a){var n="",r=encodeURIComponent(window.location.href),o=new Date(this.StartDate.replace(/-/g,"/")),c=new Date(this.EndDate.replace(/-/g,"/")),l=new s(o).format("Ymd"),h=new s(c).format("Ymd"),m=s.getIntervalDay(this.StartDate,this.EndDate)||0;return this.isApp?(n=this.ubt_key["native"],i=d("ctrip://wireless/InlandHotel?checkInDate={0}&checkOutDate={1}&hotelId={2}&hotelDataType=1&{3}",l,h,e,n)):(n="#ctm_ref=mtg_activityHtlList_htl_detail",i=d("{0}hoteldetail/{1}.html?atime={2}&days={5}&isHideNavBar=YES&from={3}{4}",Lizard.HotelBuWeb,e,l,r,n,m)),Lizard.jump(i,{targetModel:this.isApp?2:0})}this.jumpPage(i)},setCalBars:function(t,e){var a=this,i="",n="",r="",o="",c="1",l=["","周一","周二","周三","周四","周五","周六","周日"];i=new s(new Date(a.switchDateFmt(t))),r=new s(new Date(a.switchDateFmt(e))),c=s.getIntervalDay(t,e),n+=i.format("n月j日"),o+=r.format("n月j日"),n+=" "+(i.format("D")||l[i.format("N")]),o+=" "+(r.format("D")||l[r.format("N")]),a.$el.find(".js_cal_bar").html(a.calender_tmpl({in_txt:n,out_txt:o,day:c})),a.night=c},handlerfixedTab:function(){var t=this;if(t.$el.find(".js_tabfilter_box ").html()){var e=document.body.scrollTop,a=this.tabOffTop;0==e&&(this.els.jsFixedTab.removeClass(this.fixetabclass),this.isTabFixed=!1,this.els.jsFixedTabWarp.attr("class","js_tabfilter_wrap ")),e>=a&&0!=e?(this.els.jsFixedTab.addClass(this.fixetabclass),this.isTabFixed=!0,t.tabHWithTips()):a>e&&(this.els.jsFixedTab.removeClass(this.fixetabclass),this.isTabFixed=!1,this.els.jsFixedTabWarp.attr("class","js_tabfilter_wrap "))}},events:{"click .js-tips":"showTipLayer","click .js-reload":"getDataPage","click .mt-list-main li":"goToDetail","click .js-banner":function(t){this.bannerLink(t)},"click .js_room_cal":function(t){u.show.call(this,t)},"click .js_others":function(){this.jumpPage("b2croom/activity?fr="+encodeURIComponent(window.location.href))}}}),p={init:function(t){var e=this,a=t,i=p;p.view=e,this.activityStartDate=e.switchDateFmt(a.activityStartDate),this.activityEndDate=e.switchDateFmt(a.activityEndDate),this.bookStartDate=e.switchDateFmt(a.bookStartDate),this.bookEndDate=e.switchDateFmt(a.bookEndDate),this.roomInfoStartDate=e.switchDateFmt(a.roomInfoStartDate),this.roomInfoEndDate=e.switchDateFmt(a.roomInfoEndDate);var n=i.calDate(e.roomInfoStartDate,e.roomInfoEndDate);if(e.calStartDate=n.calstart,e.calEndDate=n.calend,Lizard.P("checkin")&&Lizard.P("checkout"))e.StartDate=new Date(e.switchDateFmt(Lizard.P("checkin"))),e.EndDate=new Date(e.switchDateFmt(Lizard.P("checkout")));else{var r=i.checkDate(e.activityStartDate,e.activityEndDate);e.StartDate=r.checkin,e.EndDate=r.checkout}e.StartDate=new s(e.StartDate).format("Y-n-j"),e.EndDate=new s(e.EndDate).format("Y-n-j")},checkDate:function(t,e){var a,i,n=(this.view,new Date),r=end_extr=!1,o=new s(n).format("Y/n/j"),c=s.getIntervalDay(o,t),l=s.getIntervalDay(o,e),d=new Date(new s(t).format("Y/n/j")),h=new Date(new s(e).format("Y/n/j")),m=new Date(o),f=n.getHours()>=18,p=new Date(m.getTime()+24*(f?2:1)*3600*1e3),u=new Date(p.getTime()+864e5);return f&&(1==c&&(r=!0),1==l&&(end_extr=!0)),d>m?(a=r?new Date(d.getTime()+864e5):1==c?d:2==c&&f?d:new Date(d.getTime()-864e5),i=new Date(a.getTime()+864e5),calstart=a,calend=h):end_extr?(a=h,i=new Date(a.getTime()+864e5),calstart=calend=a):(a=p,i=u,calstart=a,calend=h),{checkin:a,checkout:i}},calDate:function(t,e){var a,i,n=(this.view,new Date),r=end_extr=!1,o=new s(n).format("Y/n/j"),c=s.getIntervalDay(o,t),l=s.getIntervalDay(o,e),d=new Date(t),h=new Date(e),m=new Date(o),f=n.getHours()>=18,p=new Date(m.getTime()+24*(f?2:1)*3600*1e3),u=new Date(p.getTime()+864e5);return f&&(1==c&&(r=!0),1==l&&(end_extr=!0)),d>m?r?(checkin=new Date(d.getTime()+864e5),checkout=new Date(checkin.getTime()+864e5),a=checkin,i=h):(checkin=d,checkout=new Date(checkin.getTime()+864e5),a=checkin,i=h):m>=h?(checkin=h,checkout=new Date(checkin.getTime()+864e5),a=i=checkin):end_extr?(checkin=h,checkout=new Date(checkin.getTime()+864e5),a=i=checkin):(checkin=p,checkout=u,a=checkin,i=h),{calstart:a,calend:i}}},u={show:function(t){var e=this,a="in";if(u.view=e,t)var i=$(t.currentTarget),n=i.attr("data-type"),a=n.split("_")[1];var o=e.calEndDate?e.calEndDate:e._addDay365,c="in"==a,l=c?e.StartDate:e.EndDate,d=c?e.calStartDate:new s(e.switchDateFmt(e.StartDate)).addDay(1),h=c?o:new s(o).addDay(1);e.listcalendar&&e.listcalendar.destroy(),e.listcalendar=new r({datamodel:{displayMonthNum:12,startTime:d,endTime:h},onShow:function(){this.addCurDateMark(this,l,c?3:4)},onItemClick:function(t,a,i){$('li[data-cndate="'+e.listcalendarPre+'"]').removeClass("bluebg"),$(i.currentTarget).toggleClass("bluebg"),this.removeCurDateMark(this),this.hide();var n="",r="";c?(n=new s(t).format("Y-m-d"),e.StartDate=$(i.currentTarget).attr("data-cndate"),t.getTime()>=new Date(e.switchDateFmt(e.EndDate)).getTime()&&(e.EndDate=new s(t.getTime()+864e5).format("Y-n-j")),r=e.EndDate):(e.EndDate=$(i.currentTarget).attr("data-cndate"),n=e.StartDate,r=new s(t).format("Y-m-d")),e.setCalBars(n,r),e.getDataPage()},addCurDateMark:function(t,e,a){var i=t.$el.find('li[data-cndate="'+e+'"]'),n=["开始","结束","入住","离店"][a-1];i.hasClass("cm-item--disabled")||(i.addClass("cui_cld_daycrt"),a&&i.append("<span>"+n+"</span>"))},removeCurDateMark:function(t,e){t.$el.find(".cui_cld_daycrt").each(function(t){$(this).removeClass("cui_cld_daycrt"),$(this).find("span")&&$(this).find("span").remove()})},hide:function(){Lizard.hideHisCtnrView(),this.isCtnrView=!1,w.reset()}}),e.saveScrollPos(),Lizard.showHisCtnrView(function(){e.listcalendar&&(e.listcalendar.wrapper=this.$el,e.listcalendar.show(),e.headerview.set({title:"选择日期",back:!0,events:{returnHandler:function(){Lizard.hideHisCtnrView()}}}),e.headerview.show(),!e.isApp&&this.$el.find("ul.cm-calendar-hd").attr("style","top:44px !important"),this.$el.find(".cal-header-back").on("click",function(){Lizard.hideHisCtnrView()}),e.isCtnrView=!0)},function(){},{pageConfig:{model:{},pageUrl:window.location.pathname+window.location.search+"?frcalander=1"}})}},w={init:function(){function t(t){if(!This.isCtnrView){var i=0;i=document.body.scrollTop,100>=i&&(This.tabOffTop=parseInt(e.$el.find(".js_cal_bar").offset().top)-(e.isApp?0:39)),a.handlerfixedTab.call(e)}}var e=this,a=w;a.$fixedWrap=e.$el.find(".js_cal_bar"),a.$fixedBar=e.$el.find(".js-fixed-content"),e.isApp?e.fixetabclass=Lizard.isIPhoneX?"tab-fixed-top-phonex":"tab-fixed-top-app":e.fixetabclass="tab-fixed-top";var e=This=this,i=0;$("body").on("touchstart",function(){i=event.changedTouches[0].pageY}),$("body").on("touchmove",t),$("body").on("touchend",t),$(window).on("scroll",t)},handlerfixedTab:function(){var t=this,e=w;if(e.$fixedWrap=t.$el.find(".js_cal_bar"),e.$fixedBar=t.$el.find(".js-fixed-content"),""!=e.$fixedWrap.html()){var a=document.body.scrollTop,i=this.tabOffTop;0==a&&(e.$fixedBar.removeClass(this.fixetabclass),this.isTabFixed=!1),a>=i&&0!=a?(e.$fixedBar.addClass(this.fixetabclass),this.isTabFixed=!0):i>a&&(e.$fixedBar.removeClass(this.fixetabclass),this.isTabFixed=!1)}},off:function(){$("body").off("touchmove"),$("body").off("touchend"),$(window).off("scroll")},reset:function(){var t=this;t.$fixedBar.hasClass(this.fixetabclass)&&(t.$fixedBar.removeClass(this.fixetabclass),this.isTabFixed=!1)}};return c(f)});